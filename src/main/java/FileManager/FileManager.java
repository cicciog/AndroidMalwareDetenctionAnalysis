package FileManager;

import java.io.*;
import java.net.URL;
import java.net.URLConnection;

public class FileManager {

    public boolean createDirectory (String path) {
        boolean directoryAlreadyCreated = false;
        File directory = new File(path);

        if (!directory.exists()) {
            directoryAlreadyCreated = directory.mkdirs();
        }

        return directoryAlreadyCreated;
    }

    public boolean downloadFile (String urlStr, String filePath) throws IOException {
        boolean fileAlreadyDownloaded = false;
        File file = new File(filePath);

        if (!file.isFile()) {
            System.out.println("FILE NON ANCORA SCARICATO");

            int byteScaricati = 0;
            float percentuale = 0;
            int timer = 0;

            URL url = new URL(urlStr);

            //Size of file
            URLConnection urlConnection = url.openConnection();
            urlConnection.connect();
            int fileSize = urlConnection.getContentLength();

            BufferedInputStream bis = new BufferedInputStream(url.openStream());
            FileOutputStream fis = new FileOutputStream(filePath);
            byte[] buffer = new byte[1024];
            int count = 0;
            while ((count = bis.read(buffer, 0, 1024)) != -1) {
                fis.write(buffer, 0, count);

                byteScaricati += count;
                timer++;

                if ((timer % 100) == 0) {
                    percentuale = ((float) byteScaricati / fileSize) * 100;
                    System.out.printf("Download in corso: %.2f%%\n", percentuale);
                }

            }

            System.out.println("Download in corso: 100%");
            System.out.println("Download completato!!!");

            fis.close();
            bis.close();

            fileAlreadyDownloaded = true;
        } else {
            System.out.println("FILE GIA' SCARICATO");
        }

        return fileAlreadyDownloaded;
    }

    public String executeCommand(String command) throws IOException, InterruptedException {

        StringBuffer output = new StringBuffer();

        Process p = Runtime.getRuntime().exec(command);
        p.waitFor();
        BufferedReader reader = new BufferedReader(new InputStreamReader(p.getInputStream()));

        String line = "";
        while ((line = reader.readLine())!= null) {
            output.append(line + "\n");
        }

        return output.toString();

    }

    public void deleteFolder(File folder) {
        File[] files = folder.listFiles();
        if (files!=null) {
            for (File f: files) {
                if (f.isDirectory()) {
                    deleteFolder(f);
                } else {
                    f.delete();
                }
            }
        }
        folder.delete();
    }
}